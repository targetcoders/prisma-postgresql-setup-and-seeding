# Prisma + PostgreSQL Setup & Data Seeding (with TypeScript and Next.js)

## .env.local and .env
```env
DATABASE_URL="postgresql://username:password@localhost:5432/dbname?schema=public"
```

## prisma.config.ts

```ts
// This file was generated by Prisma, and assumes you have installed the following:
// npm install --save-dev prisma dotenv
import "dotenv/config";
import { defineConfig } from "prisma/config";

export default defineConfig({
  schema: "prisma/schema.prisma",
  migrations: {
    path: "prisma/migrations",
  },
  datasource: {
    url: process.env["DATABASE_URL"],
  },
});

```

## prisma/schema.prisma
* with sample models


```prisma
generator client {
  provider = "prisma-client-js"

}

datasource db {
  provider = "postgresql"
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String
  roles     UserRole[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Role {
  id        Int        @id @default(autoincrement())
  name      String     @unique
  users     UserRole[]
  createdAt DateTime   @default(now())
}

model UserRole {
  userId String
  roleId Int

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  role Role @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@id([userId, roleId])
}

```

## prisma/seed.ts
* with sample data

```ts
import "dotenv/config";

// must import adapter for prisma versions 7+
// adapter is required for new prisma versions
// adapter will help to resolve following prisma issue
// PrismaClientInitializationError: `PrismaClient` needs to be constructed with a non-empty, valid `PrismaClientOptions`
import { PrismaPg } from '@prisma/adapter-pg';
import { PrismaClient } from "@prisma/client";

const connectionString = process.env.DATABASE_URL;
const adapter = new PrismaPg({connectionString});
const prisma = new PrismaClient({ adapter });

////////////////////////////

// Sample data (seeding)

async function main() {
  // Seeding users data

  const user1 = await prisma.user.upsert({
    where: { email: "me@example.com" },
    update: {},
    create: {
      email: "me@example.com",
      password: "password123" // plain password only for seeding. in production, must hash password
    }
  });

  const user2 = await prisma.user.upsert({
    where: { email: "you@example.com" },
    update: {},
    create: {
      email: "you@example.com",
      password: "password123" // plain password only for seeding. in production, must hash password
    }
  });

  console.log({ user1, user2 });
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
```

## Commands
### Generate Prisma Client & tables
```bash
npx prisma generate
```
### Seed data
```bash
npx ts-node prisma/seed.ts
```
### View data with Prisma Studio
```bash
npx prisma studio
```
